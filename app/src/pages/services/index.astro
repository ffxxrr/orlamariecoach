---
// src/pages/services/index.astro
// import { getCollection } from 'astro:content'; // Removed
import MainLayout from '../../layouts/MainLayout.astro';
import ServiceCard from '../../components/services/ServiceCard.astro';
import { connectToDatabase } from '../../utils/db/connect.js';
import Service from '../../utils/db/models/Service.js';

let dbServices = [];
try {
  await connectToDatabase();
  // Fetch all services from MongoDB
  const allServicesFromDb = await Service.find({})
    .sort({ order: 1 }) // Sort by the order field, ascending
    .lean();

  // Adapt the structure to match what ServiceCard expects (data property)
  dbServices = allServicesFromDb.map(service => ({
    id: service._id.toString(),
    slug: service.slug, // Pass slug for linking
    data: {
      title: service.title,
      description: service.description,
      price: service.price,
      duration: service.duration,
      image: service.image,
      order: service.order,
      // Add other fields expected by ServiceCard if necessary
    }
  }));

} catch (error) {
  console.error("Error fetching services from DB:", error);
  // Handle error appropriately
}

const pageTitle = "Coaching Services";
const pageDescription = "Explore our range of coaching services designed to help you achieve your personal and professional goals.";
---

<MainLayout title={pageTitle} description={pageDescription}>
  <div class="container mx-auto px-4 py-8 lg:py-16">
    <header class="mb-8 lg:mb-12 text-center">
      <h1 class="text-3xl lg:text-4xl font-extrabold text-gray-900 dark:text-white mb-4">
        {pageTitle}
      </h1>
      <p class="text-lg font-light text-gray-500 dark:text-gray-400">
        {pageDescription}
      </p>
    </header>

    {dbServices.length > 0 ? (
      <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
        {dbServices.map((service) => (
          <ServiceCard service={service} /> // Pass the adapted service object
        ))}
      </div>
    ) : (
      <p class="text-center text-gray-500 dark:text-gray-400">
        Details about our services are coming soon. Please check back later!
      </p>
    )}

    {/* TODO: Add a section about the general coaching approach or a CTA */}
  </div>
</MainLayout>
